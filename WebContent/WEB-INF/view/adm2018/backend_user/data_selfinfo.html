<% var cssSec={ %>
<style>
.btn-file {
	background-color: #0c7897 !important;
}

.btn-primary:hover {
	background-color: #337ab7 !important;
}

.r {
	height: 500px;
	text-align: center;
	overflow: hidden;
}

.r img {
	max-width: 300px !important;
	max-height: 300px !important;
}
</style>
<link rel="stylesheet"
	href="${cxt!}/ui/thairice/CSS/bootstrap-imginput.css">
<link rel="stylesheet" href="${cxt!}/ui/thairice/CSS/data_selfinfo.css">
<% }; %> <% var contSec={ %>
<div>
	<div class="self_left" style="position: fixed; left: 16.5%;">
		<div class="self_info">
			<p class="self_title text-center">Personal center</p>
			<dl class="dl-horizontal">
				<dt class="self_photo">
					<form id="uploadForm">
						<div class="form-group" data-toggle="modal" data-target="#upload">
							<div class="fileinput fileinput-new" data-provides="fileinput"
								id="exampleInputUpload" style="background-color: none;">
								<div class="fileinput-new thumbnail"
									style="width: 100px; height: 100px; border: none; padding: 0;">
									<img
										src="${cxt!}${admin.heading!'/ui/thairice/Images/self_info/photo.jpg'}"
										id='picImg' alt="" style="cursor: pointer;"/>
								</div>
								<div class="fileinput-preview fileinput-exists thumbnail"
									style="width: 100px; height: 100px; border: none; padding: 0;"></div>
		<!-- 						<div style="cursor: pointer;">
									<span class="btn-file"
										style="cursor: pointer; background-color: rgba(240, 248, 255, 0);">
										<span class="fileinput-new">Change picture</span> <span
										class="fileinput-exists">Change picture</span>
									</span>
								</div> -->
							</div>
						</div>
					</form>
				</dt>
				<dd class="self_dd">
					<p class="name" style="font-size: 16px;">${admin.name_}</p>
					<!-- <p>928078226</p> -->
				</dd>
			</dl>
			<button type="button"
				class="btn btn-primary btn-lg btn-block reset_btn"
				data-toggle="modal" data-target="#passwordModal">Reset
				Password</button>
			<a href="${cxt!}/jf/thairice/admin/user/exit" type="button"
				class="btn btn-primary btn-lg btn-block logout_btn" role="button">Log
				Out</a>
		</div>
	</div>
	<div class="self_content">
		<p class="personal_text">
			<span>Personal information</span>
		</p>
		<form class="form-horizontal tab-form" id="info"
			style="width: 640px; margin: 0 auto;">
			<p class="text-center form_title">< User information ></p>
			<div class="form-group">
				<label class="col-md-3 control-label" style="width: 120px;">Account</label>
				<div class="col-md-9" style="width: 470px;">
					<input type="text" class="form-control" readonly
						value="${admin.account}" placeholder="Jone">
				</div>
			</div>
			<div class="form-group">
				<label class="col-md-3 control-label" style="width: 120px;">Mobile</label>
				<div class="col-md-9" style="width: 470px;">
					<input type="text" class="form-control" name="t3user.phone"
						value="${admin.phone}" placeholder="+66 0808899999">
				</div>
			</div>
			<div class="form-group">
				<label class="col-md-3 control-label" style="width: 120px;">Email</label>
				<div class="col-md-9" style="width: 470px;">
					<input type="email" class="form-control" id="u_email"
						name="t3user.email" value="${admin.email}"
						placeholder="jone@example.com">
				</div>
			</div>
			<div class="form-group">
				<label class="col-md-3 control-label" style="width: 120px;">Nickname</label>
				<div class="col-md-9" style="width: 470px;">
					<input type="text" class="form-control" name="t3user.name_"
						value="${admin.name_}" placeholder="Yingluck Chinnawat">
				</div>
			</div>
			<div class="form-group">
				<label class="col-md-3 control-label" style="width: 120px;">Organization</label>
				<div class="col-md-9" style="width: 470px;">
					<input type="text" class="form-control" name="t3user.company"
						value="${admin.company}" placeholder="Your current job">
				</div>
			</div>
			<div class="form-group">
				<label class="col-md-3 control-label" style="width: 120px;">Zip
					code</label>
				<div class="col-md-9" style="width: 470px;">
					<input type="text" class="form-control" name="t3user.zip_encode"
						value="${admin.zip_encode}" placeholder="Zip code">
				</div>
			</div>
			<div class="form-group">
				<label class="col-md-3 control-label" style="width: 120px;">Address</label>
				<div class="col-md-9" style="width: 470px;">
					<input type="text" class="form-control" name="t3user.address"
						value="${admin.address}" placeholder="Your address">
				</div>
			</div>
<!-- 			<div class="form-group">
				<label class="col-md-3 control-label" style="width: 120px;">Industry</label>
				<div class="col-md-9" style="width: 470px;">
					<input type="text" class="form-control" name="t3user.industry"
						value="${admin.industry}" placeholder="Your industry">
				</div>
			</div> -->
			<div class="form-group">
				<button type="button"
					class="btn btn-primary btn-lg btn-block modify_btn" id="modify_btn"
					style="width: 360px; margin: 10px auto;">Modify the
					information</button>
			</div>
			<input type="hidden" value="${admin.id}" name="t3user.id">
		</form>
	</div>
</div>
<!--system message modal-->
<div class="modal fade" id="systemModal" tabindex="-1" role="dialog"
	aria-labelledby="systemModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">System message</h5>
				<button class="close" type="button" data-dismiss="modal"
					aria-label="Close">
					<span aria-hidden="true">×</span>
				</button>
			</div>
			<div class="modal-body">
				Congratulations on your revision of the password<br> and you
				will jump to the login page after&nbsp;&nbsp;&nbsp;&nbsp;<span>5</span>
				s
			</div>
			<div class="modal-footer" style="text-align: center;">
				<a href="${cxt!}/jf/thairice/t3user/exit"
					class="btn btn-primary go_btn" type="button" data-dismiss="modal">Go
					now</a>
			</div>
		</div>
	</div>
</div>
<!--upload head modal-->
<div class="modal fade" id="upload" tabindex="-1" role="dialog"
	aria-labelledby="systemModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Upload a profile picture</h5>
				<button class="close" type="button" data-dismiss="modal"
					aria-label="Close">
					<span aria-hidden="true">×</span>
				</button>
			</div>
			<div class="modal-body">
				<div class="r">
					<input id="file-Portrait1" name="head" type="file"
						style="background-color: none;">
				</div>
			</div>
			<div class="modal-footer" style="text-align: center;">
				<button class="btn btn-secondary" type="button" data-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>
<!--password modify modal-->
<div class="modal fade" id="passwordModal" tabindex="-1" role="dialog"
	aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document" style="width: 650px;">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="exampleModalLabel">Reset Password</h5>
				<button class="close" type="button" data-dismiss="modal"
					aria-label="Close">
					<span aria-hidden="true">×</span>
				</button>
			</div>
			<div class="modal-body">
				<form class="form-horizontal" id="edit_pass">
					<div class="form-group">
						<label class="col-sm-3 control-label">New password</label>
						<div class="col-sm-9">
							<input type="password" name="pwd" class="form-control"
								placeholder="The passwords must contain at least 2 kinds of letters, numbers and symbols">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-3 control-label">Re-enter password</label>
						<div class="col-sm-9">
							<input type="password" class="form-control" name="again"
								placeholder="Re-enter new password">
						</div>
					</div>

					<div class="form-group">
						<label class="col-sm-3 control-label">Email</label>
						<div class="col-sm-9">
							<div class="input-group">
								<input type="email" class="form-control"
									placeholder="your E-mai like someone@exmaple.com" name="email"
									id="email" value="${admin.email}" readonly> <span
									class="input-group-addon" id="send_email"
									style="background-color: #5cb85c; color: #fff; background-color: #5cb85c; cursor: pointer;">Send
									authorization code</span>
							</div>
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-3 control-label">Verification code</label>
						<div class="col-sm-9">
							<input type="text" class="form-control"
								placeholder="Please enter the verification code from your e-mail"
								name="code">
						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button class="btn btn-primary system_btn" id="pass_btn"
					type="button">Submit</button>
				<button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
			</div>
		</div>
	</div>
</div>
<% }; %> <% var jsSec={ %>
<script src="${cxt!}/ui/thairice/JS/bootstrap-imginput.js"></script>
<script src="${cxt!}/ui/thairice/bootstrap-fileinput-master/js/fileinput.min.js"></script>
<script src="${cxt!}/ui/thairice/JS/bootstrapValidator.js"></script>
<script type="text/javascript" src="${cxt!}/ui/thairice/JS/layer/layer.js"></script>
<script src="${cxt!}/ui/thairice/common.js"></script>
<script>
	//修改个人信息
	$('#modify_btn').click(
			function() {
				$("#info").bootstrapValidator('validate');
				if (!$("#info").data('bootstrapValidator').isValid()) {
					return;
				}
				sendAjax('${cxt!}/jf/thairice/admin/user/edit_info', $("#info")
						.serialize(), function(res) {
					$('#eemail').val($('#u_email').val());
					$("#info").bootstrapValidator('resetForm');
					showMessage(res.desc);
				});
			})
	//发送邮箱授权码
	$('#send_email').click(function() {
		    sendAjax("${cxt!}/jf/thairice/t3user/send_code", {email : $("#email").val()}, function(res) {
			showMessage(res.desc);
		}); 
	})
	//修改密码
	$('#pass_btn')
			.click(
					function() {
						$("#edit_pass").bootstrapValidator('validate');
						if (!$("#edit_pass").data('bootstrapValidator')
								.isValid()) {
							return;
						}
						sendAjax(
								'${cxt!}/jf/thairice/admin/user/edit_pass',
								$("#edit_pass").serialize(),
								function(res) {
									layer.msg(res.desc);
									if (res.code == 1) {
										$("#passwordModal").modal("hide");
										$("#systemModal").modal("show");
										setTimeout(
												function() {
													window.location.href = "${cxt!}/jf/thairice/admin/user/exit"
												}, 5000);
									}
								});
					})
	//上传头像
	$("#file-Portrait1").fileinput({
		language : 'zh', //设置语言
		uploadExtraData : {
			id : '${admin.id}'
		},
		uploadUrl : '${cxt!}/jf/thairice/admin/user/upload_head', //上传的地址
		allowedFileExtensions : [ 'jpg', 'png','gif' ],//接收的文件后缀
		showUpload : false, //是否显示上传按钮
		showCaption : false,//是否显示标题
		showCancel : false,
		autoReplace : true,
		showBrowse : true,
		showClose : false,
		dropZoneEnabled : false,//是否允许拖拽
		uploadAsync : true,
		maxFileSize : 1024,
		maxFileCount : 1,
		browseClass : "btn btn-primary", //按钮样式
		previewFileIcon : "<i class='glyphicon glyphicon-king'></i>",
	});
	//异步上传返回结果处理
	$("#file-Portrait1").on("fileuploaded",
			function(event, data, previewId, index) {
				console.log(JSON.stringify(data));
				if (data.response.code == 1) {
					layer.msg('Uploaded successful');
					$('#picImg').attr("src", "${cxt!}" + data.response.desc);
				}
			});
	//修改密码参数校验 
	$("#edit_pass")
			.bootstrapValidator(
					{
						message : 'This value is not valid',
						feedbackIcons : {
							/*输入框不同状态，显示图片的样式*/
							valid : 'glyphicon glyphicon-ok',
							validating : 'glyphicon glyphicon-refresh'
						},
						fields : {
							/*验证*/
							'pwd' : {
								validators : {
									notEmpty : {
										message : 'The password is required and can\'t be empty '
									},
									regexp : {
										regexp : /^(?![\d]+$)(?![a-zA-Z]+$)(?![^\da-zA-Z]+$).{6,20}$/,
										message : 'The passwords must contain at least 2 kinds of letters, numbers and symbols and the length is 6-20 characters'
									}
								}
							},
							'again' : {
								message : 'Password is invalid',
								validators : {
									notEmpty : {
										message : 'Password is  required and can\'t be empty'
									},
									identical : {//相同
										field : 'pwd',
										message : ' Two input password must be consistent'
									}
								}
							},
							'code' : {
								message : 'Password is invalid',
								validators : {
									notEmpty : {
										message : 'Verification code is  required and can\'t be empty'
									}
								}
							}
						}
					});
	//修改个人信息参数校验 
	$("#info").bootstrapValidator({
		message : 'This value is not valid',
		feedbackIcons : {
			/*输入框不同状态，显示图片的样式*/
			valid : 'glyphicon glyphicon-ok',
			validating : 'glyphicon glyphicon-refresh'
		},
		fields : {
			/*验证*/
			't3user.phone' : {
				validators : {
					notEmpty : {
						message : 'Mobile is required and can\'t be empty'
					},
					stringLength : {
						/*长度提示*/
						min : 6,
						max : 11,
						message : 'Mobile length is 10'
					},
					regexp : {
						regexp : /^0\d{9}$/,
						message : 'Mobile number is not correct '
					}
				}
			}
		}
	});
</script>
<% }; %> <%
include("../layout.html",{cssSec:cssSec,contSec:contSec,jsSec:jsSec}){}
%>
